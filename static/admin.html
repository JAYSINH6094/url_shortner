<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {font-family:Arial;background:#0f172a;color:white;padding:40px;}
table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;   /* ðŸ”¥ important */
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #334155;
    text-align: left;
    vertical-align: middle;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

th {
    background: #1e293b;
    font-weight: 600;
}

tr:hover {
    background: #1e293b;
}

th:nth-child(1), td:nth-child(1) { width: 5%; }   /* ID */
th:nth-child(2), td:nth-child(2) { width: 30%; }  /* Original URL */
th:nth-child(3), td:nth-child(3) { width: 15%; }  /* Short */
th:nth-child(4), td:nth-child(4) { width: 10%; }  /* Clicks */
th:nth-child(5), td:nth-child(5) { width: 20%; }  /* Created */
th:nth-child(6), td:nth-child(6) { width: 20%; }  /* Expiry */

</style>
</head>
<body>

<h1>ðŸ“Š URL Dashboard</h1>
<input id="search" placeholder="Search..." onkeyup="filterTable()">

<table>
<thead>
<tr>
  <th>ID</th>
  <th>Original URL</th>
  <th>Short URL</th>
  <th>Clicks</th>
  <th>Created</th>
  <th>Expires</th>
</tr>

</thead>
<tbody id="tableBody"></tbody>
</table>

<script>
let tableData=[];

async function loadData(){
  const res=await fetch("http://127.0.0.1:8000/admin/urls");
  const data=await res.json();
  tableData=data;
  renderTable(data);
  renderChart(data);
}

function renderTable(data){
  document.getElementById("tableBody").innerHTML = data.map(u => `
    <tr>
      <td>${u.id}</td>
      <td>${u.original_url}</td>
      <td>
        <a href="http://127.0.0.1:8000/${u.short_code}" target="_blank">
          ${u.short_code}
        </a>
      </td>
      <td>${u.clicks}</td>
      <td>${new Date(u.created_at).toLocaleString()}</td>
      <td>${u.expiry_date ? new Date(u.expiry_date).toLocaleString() : "Never"}</td>
    </tr>
  `).join("");
}

function filterTable(){
  const val=document.getElementById("search").value.toLowerCase();
  renderTable(tableData.filter(r=>r.original_url.toLowerCase().includes(val)));
}
loadData();
</script>
</body>
</html>
